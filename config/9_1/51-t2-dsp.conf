# WirePlumber configuration for T2 MacBook Air 9,1 DSP
# Uses node.software-dsp module like Asahi Linux to properly hide raw devices

# Create DSP filter chain and hide raw device
node.software-dsp.rules = [
    # Speakers DSP
    {
        matches = [
            { api.alsa.card.name = "Apple T2 Audio", alsa.id = "Speaker" }
        ]
        actions = {
            create-filter = {
                filter-path = "/usr/share/t2-linux-audio/9_1/graph.json"
                hide-parent = true
            }
        }
    }
]

# Load the force-unmute Lua script to actively prevent muting
wireplumber.components = [
    {
        name = /usr/share/t2-linux-audio/9_1/t2-force-unmute.lua, type = script/lua,
        provides = custom.t2-audio
    }
]

# Enable required modules
wireplumber.profiles = {
    main = {
        node.software-dsp = required
        custom.t2-audio = required
    }
}

