# WirePlumber configuration for T2 MacBook Pro 16,4 DSP
# Uses node.software-dsp module like Asahi Linux to properly hide raw devices

# Create DSP filter chains and hide raw devices
node.software-dsp.rules = [
    # Speakers DSP
    {
        matches = [
            { api.alsa.card.name = "Apple T2 Audio", alsa.id = "Speaker" }
        ]
        actions = {
            create-filter = {
                filter-path = "/usr/share/t2-linux-audio/16_4/graph.json"
  MacBookPro16,1 16_1              hide-parent = true
            }
        }
    }
    # Mic DSP
    {
        matches = [
            { api.alsa.card.name = "Apple T2 Audio", alsa.id = "Digital Mic" }
        ]
        actions = {
            create-filter = {
                filter-path = "/usr/share/t2-linux-audio/16_4/mic.json"
                hide-parent = true
            }
        }
    }
]

# Load the force-unmute Lua script to actively prevent muting
wireplumber.components = [
    {
        name = /usr/share/t2-linux-audio/16_4/t2-force-unmute.lua, type = script/lua,
        provides = custom.t2-audio
    }
]

# Enable required modules
wireplumber.profiles = {
    main = {
        node.software-dsp = required
        custom.t2-audio = required
    }
}
